<video id="video" width="480" src="https://storage.googleapis.com/fbeaufort-test/sample-video.webm"></video>
<br/>
<button id="button1">button1</button>
<button id="button2">button2</button>
<button id="button3">button3</button>
<button id="button4">button4</button>
<button id="button5">button5</button>
<button id="button6">button6</button>
<script>window.onload = function() {

button1.onclick = async function() {
  const p1 = video.requestPictureInPicture();
  const p2 = video.requestPictureInPicture();
  const p3 = video.requestPictureInPicture();
  const p4 = video.requestPictureInPicture();
  console.log((await p1).width);
  console.log((await p2).width);
  console.log((await p3).width);
  console.log((await p4).width);
}

button2.onclick = async function() {
  const p1 = video.requestPictureInPicture();
  const p2 = video.requestPictureInPicture();
  const p3 = video.requestPictureInPicture();
  const p4 = video.requestPictureInPicture();
  const values = await Promise.all([p1, p2, p3, p4]);
  for (const value of values) {
    console.log(value.width);
  }
}

button3.onclick = async function() {
  const p1 = video.requestPictureInPicture();
  const p2 = video.requestPictureInPicture();
  const p3 = video.requestPictureInPicture();
  const p4 = video.requestPictureInPicture();
  // Wait 1s before calling Promise.all
  await new Promise(r => setTimeout(r, 1000));
  const values = await Promise.all([p1, p2, p3, p4]);
  for (const value of values) {
    console.log(value.width);
  }
}

button4.onclick = async function() {
  const p1 = video.requestPictureInPicture();
  const p2 = video.requestPictureInPicture();
  const p3 = video.requestPictureInPicture();
  const p4 = video.requestPictureInPicture();
  const values = await Promise.all([p1, p2, p3, p4]);
  // Wait 1s before explicitely asking for width
  await new Promise(r => setTimeout(r, 1000));
  for (const value of values) {
    console.log(value.width);
  }
}

button5.onclick = async function() {
  const p1 = video.requestPictureInPicture();
  const p2 = video.requestPictureInPicture();
  const p3 = video.requestPictureInPicture();
  const p4 = video.requestPictureInPicture();
  // Wait 1s before explicitely asking for width
  await new Promise(r => setTimeout(r, 1000));
  console.log((await p1).width);
  console.log((await p2).width);
  console.log((await p3).width);
  console.log((await p4).width);
}

button6.onclick = async function() {
  const p1 = video.requestPictureInPicture();
  const p2 = video.requestPictureInPicture();
  const p3 = video.requestPictureInPicture();
  const p4 = video.requestPictureInPicture();
  const v1 = await p1;
  const v2 = await p2;
  const v3 = await p3;
  const v4 = await p4;
  console.log(v1.width);
  console.log(v2.width);
  console.log(v3.width);
  console.log(v4.width);
}

video.addEventListener('enterpictureinpicture', e => { console.log('enterpictureinpicture'); });
video.addEventListener('leavepictureinpicture', e => { console.log('leavepictureinpicture'); });

}</script>
